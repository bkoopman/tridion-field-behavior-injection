#summary GUI Extension Installer PowerShell Script

= Introduction =

Script to install this and other SDL Tridion GUI Extensions.

* Creates Virtual Directory in IIS
* Copies DLL folders to WebRoot/bin.  Folder must be called 'dlls'
* Copies all other folders to the GUI Extension root folder

= How to Use =
Save the text file here as a .ps1 file and run with PowerShell console on the Tridion CMS Server

= CODE =
{{{
Write-Host "***************************************************************"
Write-Host "*           Tridion GUI Extensions Installer 1.0              *"
Write-Host "*                                                             *"
Write-Host "*  Create a folder called 'Configuration'                     *"
Write-Host "*      - The config file should be named editor.config        *"
Write-Host "*                                                             *"
Write-Host "*  Copies dll files to WebRoot bin                            *"
Write-Host "*  Copies all other files to Extension root                   *"
Write-Host "*  Creates VDir in Editors section in Tridion IIS             *"
Write-Host "*  Updates System.config                                      *"
Write-Host "*                                                             *"
Write-Host "*                                                             *"
Write-Host "***************************************************************"

# import various stuff we need
[Reflection.Assembly]::LoadWithpartialName("System.Xml.Linq") | Out-Null
[string]$name = Read-Host "What is the name of the GUI Extension?"

#Install location
$tridionInstallLocationUser = Read-Host "Where is Tridion installed? (Default is C:\Program Files (x86)\Tridion)"
[string]$tridionInstallLocation = "C:\Program Files (x86)\Tridion\"

if($tridionInstallLocationUser -ne "")
{
	$tridionInstallLocation = $tridionInstallLocationUser
}

[string]$destination = $tridionInstallLocation + "web\WebUI\Editors\" + $name

Write-Host "Installing GUI Extension to " + $destination

$editorConfigFile = "Configuration\editor.config"

# Update System.config
  $filename = $tridionInstallLocation + '\web\WebUI\WebRoot\Configuration\System.config'
  $conf = [xml](gc $filename)
  $editors = [System.Xml.XmlElement]$conf.Configuration.editors
  $myElement = $conf.CreateElement("editor")
  $nameAttr = $myElement.SetAttribute("name", $name)
  $myElement.InnerXml = "<installpath>" + $destination + "</installpath><configuration>" + $editorConfigFile + "</configuration><vdir>" + $name + "</vdir>"
  $editors.AppendChild($myElement)
  $conf.Save($filename)

# Create VDIR in Tridion/WebUI/Editors  2011 / 2013 need input 
  $tridionVersion = Read-Host "Which version of Tridion do you use? (2011 or 2013.  Default is 2013)"
  if(($tridionVersion -ne "2011") -and($tridionVersion -ne "2013"))
  {
	$tridionVersion = "2013"
  }
  
  $vdirPath = 'IIS:\Sites\SDL Tridion ' + $tridionVersion + '\WebUI\Editors\' + $name 
  Write-Host "Creating IIS Virtual Directory at " + $vdirPath
  New-Item $vdirPath -type VirtualDirectory -physicalPath $destination

# Copy dll files
if(Test-Path dlls -pathType container)
{
	$webRootBin = $tridionInstallLocation + "\web\WebUI\WebRoot\bin"	
	Write-Host "Copying items to " + $webRoot
	Copy-Item -Path "dlls\*" $webRootBin -recurse
}
  
#Copy all other files to GUI Extension root except dlls
# ToDo, Use different code to copy the folders.  Exclude option not working here
# http://stackoverflow.com/questions/731752/exclude-list-in-powershell-copy-item-does-not-appear-to-be-working
Copy-Item -Path ".\" $destination -recurse -exclude "\dlls"
	
Write-Host "============================================"
Write-Host "Done"
}}}